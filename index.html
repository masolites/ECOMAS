 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MASOLITES ECOMAS</title>
    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="MASOLITES ECOMAS - A Better Society Together">
    <meta property="og:description" content="Economic Community Of Masolites. A Trusted Products & Services Hub using MAZOL Token">
    <meta property="og:image" content="https://masolites.github.io/ECOMAS/social-banner.jpg">
    <meta property="og:url" content="https://masolites.github.io/ECOMAS">
    <meta name="twitter:card" content="summary_large_image">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js" type="application/javascript"></script>
    <script src="https://checkout.flutterwave.com/v3.js"></script>
    <style>
        /* CSS remains the same as before */
    </style>
</head>
<body>
    <!-- Social Media Overlay -->
    <div class="social-overlay" id="socialOverlay">
        <!-- Content remains the same -->
    </div>
    
    <div class="app-container">
        <!-- Top header remains the same -->
        
        <div class="main-content">
            <!-- All cards remain the same -->
        </div>
    </div>

    <!-- Auth Modals remain the same -->

    <!-- Save & Earn Modal remains the same -->

    <!-- Dashboard Modal remains the same -->

    <!-- Buy Options Modal remains the same -->

    <!-- Admin Access Modal remains the same -->

    <!-- Escrow Shop Modal remains the same -->

    <!-- Product Detail Modal remains the same -->

    <script>
        // Tokenomics Configuration
        const TOKENOMICS = {
            totalSupply: 50000000,
            privateSale: 25000000,
            currentPrice: 0.001,
            ngnPrice: 18,
            miningBaseRate: 0.0000001,
            badgeMultipliers: {
                free: 1,
                bronze: 1.5,
                silver: 2,
                gold: 3,
                platinum: 4
            },
            platformFee: 0.004,
            maxFreeProducts: 3,
            discounts: {
                free: 0,
                bronze: 0.05,
                silver: 0.10,
                gold: 0.15,
                platinum: 0.20
            },
            halvingInterval: 15552000000,
            initialHalvingTime: Date.now()
        };

        // MLM Configuration
        const MLM_CONFIG = {
            levels: 5,
            commissionRate: 0.025,
            matrix: {}
        };

        // FLUTTERWAVE LIVE PUBLIC KEY - REPLACE WITH YOUR ACTUAL KEY
        const FLW_PUBLIC_KEY = "FLWPUBK-XXXXXXXXXXXXXXXXXXXXXXXXXX-X";
        
        // MAZOL Token Contract Details
        const CONTRACT_ADDRESS = "0x49F4a728BD98480E92dBfc6a82d595DA9d1F7b83";
        const CONTRACT_ABI = []; // Actual ABI would go here

        // User Management
        class UserSystem {
            static register(email, password, referralCode = null) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                
                if (users.find(u => u.email === email)) {
                    return { error: 'Email already registered' };
                }
                
                const memberId = `MSL-${Math.floor(100000 + Math.random() * 900000)}`;
                
                const user = {
                    email,
                    password: btoa(password),
                    memberId,
                    cryptoWallet: {
                        address: this.generateCryptoAddress(),
                        balance: 0
                    },
                    fiatWallet: {
                        account: `MAS_${Math.floor(1000000000 + Math.random() * 9000000000)}`,
                        balance: 0
                    },
                    badges: ['free'],
                    miningSpeed: TOKENOMICS.miningBaseRate,
                    notifications: [
                        {
                            message: 'Welcome to Masolites! Start by exploring the platform.',
                            timestamp: new Date().toISOString(),
                            read: false
                        }
                    ],
                    createdAt: new Date().toISOString(),
                    referralCode: Math.random().toString(36).substring(2, 10).toUpperCase(),
                    referredBy: referralCode,
                    products: [],
                    transfers: [],
                    socialPoints: 0,
                    mlmLevel: 0
                };
                
                users.push(user);
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                if (referralCode) {
                    MLMSystem.processReferral(referralCode, user.email, 'registration', 0);
                }
                
                return user;
            }
            
            static login(email, password) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.email === email && u.password === btoa(password));
                
                if (user) {
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    return user;
                }
                return null;
            }
            
            static getCurrentUser() {
                return JSON.parse(localStorage.getItem('currentUser'));
            }
            
            static logout() {
                localStorage.removeItem('currentUser');
            }
            
            static addNotification(user, message) {
                if (!user) return;
                
                user.notifications.unshift({
                    message,
                    timestamp: new Date().toISOString(),
                    read: false
                });
                
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const updatedUsers = users.map(u => u.email === user.email ? user : u);
                localStorage.setItem('users', JSON.stringify(updatedUsers));
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                return user;
            }
            
            static generateCryptoAddress() {
                const chars = '0123456789ABCDEF';
                let address = 'MZLx';
                for (let i = 0; i < 40; i++) {
                    address += chars[Math.floor(Math.random() * 16)];
                }
                return address;
            }
            
            static addBadge(user, badge) {
                if (!user.badges.includes(badge)) {
                    user.badges.push(badge);
                    
                    let multiplier = 1;
                    if (user.badges.includes('platinum')) multiplier = TOKENOMICS.badgeMultipliers.platinum;
                    else if (user.badges.includes('gold')) multiplier = TOKENOMICS.badgeMultipliers.gold;
                    else if (user.badges.includes('silver')) multiplier = TOKENOMICS.badgeMultipliers.silver;
                    else if (user.badges.includes('bronze')) multiplier = TOKENOMICS.badgeMultipliers.bronze;
                    else multiplier = TOKENOMICS.badgeMultipliers.free;
                    
                    user.miningSpeed = TOKENOMICS.miningBaseRate * multiplier;
                    
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    const updatedUsers = users.map(u => u.email === user.email ? user : u);
                    localStorage.setItem('users', JSON.stringify(updatedUsers));
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    
                    return true;
                }
                return false;
            }
            
            static getDiscount(user) {
                if (!user) return 0;
                
                if (user.badges.includes('platinum')) return TOKENOMICS.discounts.platinum;
                else if (user.badges.includes('gold')) return TOKENOMICS.discounts.gold;
                else if (user.b极dges.includes('silver')) return TOKENOMICS.discounts.silver;
                else if (user.badges.includes('bronze')) return TOKENOMICS.discounts.bronze;
                else return TOKENOMICS.discounts.free;
            }
        }

        // Save & Earn System
        class SaveEarn {
            static submitDeposit(amount, date, time) {
                const user = UserSystem.getCurrentUser();
                if (!user) return { error: 'Not authenticated' };
                
                const deposit = {
                    id: Date.now(),
                    userId: user.email,
                    amount,
                    date,
                    time,
                    status: 'pending',
                    timestamp: new Date().toISOString()
                };
                
                const deposits = JSON.parse(localStorage.getItem('depositSubmissions') || '[]');
                deposits.push(deposit);
                localStorage.setItem('depositSubmissions', JSON.stringify(deposits));
                
                const activity = JSON.parse(localStorage.getItem('activity') || '[]');
                activity.unshift({
                    userId: user.email,
                    action: 'Deposit Submitted',
                    details: `Manual deposit: ₦${amount}`,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('activity', JSON.stringify(activity));
                
                UserSystem.addNotification(user, `Manual deposit of ₦${amount} submitted. Waiting for admin approval.`);
                
                return deposit;
            }
            
            static processFlutterwave(amount) {
                const user = UserSystem.getCurrentUser();
                if (!user) return { error: 'Not authenticated' };
                
                FlutterwaveCheckout({
                    public_key: FLW_PUBLIC_KEY,
                    tx_ref: "DEPOSIT-" + Date.now(),
                    amount: amount,
                    currency: "NGN",
                    payment_options: "card, banktransfer, ussd",
                    customer: {
                        email: user.email,
                        name: "Masolites User"
                    },
                    callback: function(response) {
                        if (response.status === "successful") {
                            user.fiatWallet.balance += amount;
                            UserSystem.addNotification(user, `Flutterwave deposit of ₦${amount} successful!`);
                            
                            const activity = JSON.parse(localStorage.getItem('activity') || '[]');
                            activity.unshift({
                                userId: user.email,
                                action: 'Flutterwave Deposit',
                                details: `Amount: ₦${amount}`,
                                timestamp: new Date().toISOString()
                            });
                            localStorage.setItem('activity', JSON.stringify(activity));
                            
                            alert(`Successfully deposited ₦${amount}!`);
                        } else {
                            alert("Payment failed. Please try again.");
                        }
                    },
                    customizations: {
                        title: "Masolites Deposit",
                        description: "Fund your account",
                        logo: "https://masolites.com/logo.png"
                    }
                });
            }
        }

        // Mining System
        class MiningSystem {
            constructor() {
                this.miningInterval = null;
                this.minedAmount = 0;
                this.totalMined = 0;
                this.isMining = false;
                this.startTime = 0;
                this.miningDuration = 24 * 60 * 60 * 1000;
                this.lastTotalUpdate = 0;
            }
            
            startMining() {
                if (this.isMining) return;
                
                const user = UserSystem.getCurrentUser();
                if (!user) return;
                
                this.startTime = Date.now();
                this.lastTotalUpdate = this.startTime;
                
                this.miningInterval = setInterval(() => {
                    const now = Date.now();
                    const elapsed = now - this.startTime;
                    
                    if (elapsed >= this.miningDuration) {
                        this.stopMining();
                        alert('Mining session completed after 24 hours!');
                        return;
                    }
                    
                    const halvings = Math.floor((now - TOKENOMICS.initialHalvingTime) / TOKENOMICS.halvingInterval);
                    const halvingFactor = Math.pow(0.5, halvings);
                    
                    const currentMiningRate = user.miningSpeed * halvingFactor;
                    this.minedAmount = (elapsed / 1000) * currentMiningRate;
                    
                    document.getElementById('minedAmount').textContent = (currentMiningRate * 1000000).toFixed(6) + ' MZLx/s';
                    
                    if (now - this.lastTotalUpdate >= 60000) {
                        this.totalMined = (elapsed / 1000) * currentMiningRate;
                        document.getElementById('miningTotal').textContent = this.totalMined.toFixed(6) + ' MZLx';
                        localStorage.setItem('totalMined', this.totalMined.toString());
                        if (this.totalMined > 0) {
                            document.getElementById('claimButton').style.display = 'flex';
                        }
                        this.lastTotalUpdate = now;
                    }
                }, 100);
                
                this.isMining = true;
                document.getElementById('miningButton').innerHTML = '<i class="fas fa-stop"></i> MINING (ON)';
                document.getElementById('miningButton').classList.add('mining-active');
                
                UserSystem.addNotification(user, 'Mining session started!');
            }
            
            stopMining() {
                if (!this.isMining) return;
                
                clearInterval(this.miningInterval);
                this.isMining = false;
                document.getElementById('miningButton').innerHTML = '<i class="fas fa-play"></i> START MINING (OFF)';
                document.getElementById('miningButton').classList.remove('mining-active');
                localStorage.setItem('totalMined', this.totalMined.toString());
                
                const user = UserSystem.getCurrentUser();
                if (user) {
                    UserSystem.addNotification(user, 'Mining session stopped!');
                }
            }
            
            async claimTokens() {
                const user = UserSystem.getCurrentUser();
                if (!user) {
                    alert('Please login first!');
                    return;
                }
                
                if (this.totalMined <= 0) {
                    alert('No tokens to claim!');
                    return;
                }
                
                try {
                    // In a real implementation, this would interact with blockchain
                    user.cryptoWallet.balance += this.totalMined;
                    UserSystem.addNotification(user, `Claimed ${this.totalMined.toFixed(6)} MZLx from mining!`);
                    
                    this.totalMined = 0;
                    document.getElementById('miningTotal').textContent = '0.000000 MZLx';
                    document.getElementById('claimButton').style.display = 'none';
                    this.stopMining();
                    
                    alert(`Successfully claimed ${this.totalMined.toFixed(6)} MZLx!`);
                } catch (error) {
                    console.error('Error claiming tokens:', error);
                    alert('Failed to claim tokens. Please try again.');
                }
            }
        }

        // Escrow Shop System
        class EscrowShop {
            static listProduct(name, description, price, category) {
                const user = UserSystem.getCurrentUser();
                if (!user) return { error: 'Not authenticated' };
                
                if (user.badges.includes('free') && user.products.length >= TOKENOMICS.maxFreeProducts) {
                    return { error: `Free members can only list up to ${TOKENOMICS.maxFreeProducts} products. Upgrade to list more.` };
                }
                
                const product = {
                    id: Date.now(),
                    sellerId: user.email,
                    sellerAddress: user.cryptoWallet.address,
                    name,
                    description,
                    price,
                    category,
                    timestamp: new Date().toISOString(),
                    status: 'active'
                };
                
                user.products.push(product);
                
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const updatedUsers = users.map(u => u.email === user.email ? user : u);
                localStorage.setItem('users', JSON.stringify(updatedUsers));
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                const activity = JSON.parse(localStorage.getItem('activity') || '[]');
                activity.unshift({
                    userId: user.email,
                    action: 'Product Listed',
                    details: `Product: ${name}, Price: ${price} MZLx`,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('activity', JSON.stringify(activity));
                
                UserSystem.addNotification(user, `Product "${name}" listed successfully!`);
                
                return product;
            }
            
            static getAllProducts() {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const products = [];
                
                users.forEach(user => {
                    user.products.forEach(product => {
                        if (product.status === 'active') {
                            products.push({
                                ...product,
                                sellerName: user.email
                            });
                        }
                    });
                });
                
                return products;
            }
            
            static async buyProduct(productId) {
                const user = UserSystem.getCurrentUser();
                if (!user) return { error: 'Not authenticated' };
                
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                let product = null;
                let seller = null;
                
                for (const u of users) {
                    const p = u.products.find(p => p.id === productId);
                    if (p) {
                        product = p;
                        seller = u;
                        break;
                    }
                }
                
                if (!product || !seller) {
                    return { error: 'Product not found' };
                }
                
                try {
                    const discount = UserSystem.getDiscount(user);
                    const discountedPrice = product.price * (1 - discount);
                    
                    user.cryptoWallet.balance -= discountedPrice;
                    seller.cryptoWallet.balance += discountedPrice;
                    
                    product.status = 'sold';
                    
                    const updatedUsers = users.map(u => {
                        if (u.email === seller.email) {
                            u.products = u.products.map(p => 
                                p.id === product.id ? product : p
                            );
                            return u;
                        }
                        return u;
                    });
                    
                    localStorage.setItem('users', JSON.stringify(updatedUsers));
                    
                    user.transfers.push({
                        type: 'out',
                        amount: discountedPrice,
                        recipient: seller.email,
                        timestamp: new Date().toISOString(),
                        productId: product.id
                    });
                    
                    seller.transfers.push({
                        type: 'in',
                        amount: discountedPrice,
                        sender: user.email,
                        timestamp: new Date().toISOString(),
                        productId: product.id
                    });
                    
                    const updatedUsersWithBuyer = updatedUsers.map(u => 
                        u.email === user.email ? user : u
                    );
                    localStorage.setItem('users', JSON.stringify(updatedUsersWithBuyer));
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    
                    UserSystem.addNotification(user, `Purchased "${product.name}" for ${discountedPrice.toFixed(2)} MZLx`);
                    UserSystem.addNotification(seller, `Sold "${product.name}" for ${discountedPrice.toFixed(2)} MZLx`);
                    
                    return { success: true };
                } catch (error) {
                    console.error('Error buying product:', error);
                    return { error: 'Failed to complete transaction' };
                }
            }
        }

        // P2P Transfer System
        class P2PTransfer {
            static async transfer(recipientAddress, amount) {
                const user = UserSystem.getCurrentUser();
                if (!user) return { error: 'Not authenticated' };
                
                if (amount <= 0) {
                    return { error: 'Invalid amount' };
                }
                
                try {
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    const recipientUser = users.find(u => u.cryptoWallet.address === recipientAddress);
                    
                    if (!recipientUser) {
                        return { error: 'Recipient not found' };
                    }
                    
                    user.cryptoWallet.balance -= amount;
                    recipientUser.cryptoWallet.balance += amount;
                    
                    user.transfers.push({
                        type: 'out',
                        amount: amount,
                        recipient: recipientAddress,
                        timestamp: new Date().toISOString()
                    });
                    
                    recipientUser.transfers.push({
                        type: 'in',
                        amount: amount,
                        sender: user.email,
                        timestamp: new Date().toISOString()
                    });
                    
                    const updatedUsers = users.map(u => 
                        u.email === user.email ? user : 
                        u.email === recipientUser.email ? recipientUser : u
                    );
                    localStorage.setItem('users', JSON.stringify(updatedUsers));
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    
                    UserSystem.addNotification(user, `Sent ${amount} MZLx to ${recipientAddress.substring(0, 8)}...`);
                    
                    return { success: true };
                } catch (error) {
                    console.error('Error transferring tokens:', error);
                    return { error: 'Failed to complete transfer' };
                }
            }
        }

        // MLM System
        class MLMSystem {
            static processReferral(referralCode, newUserId, type, amount = 0) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const referrer = users.find(u => u.referralCode === referralCode);
                
                if (!referrer) return;
                
                const uplineChain = this.getUplineChain(referrer.email, MLM_CONFIG.levels);
                
                let commissionBase = 0;
                if (type === 'registration') {
                    commissionBase = 10;
                } else if (type === 'purchase') {
                    commissionBase = amount * MLM_CONFIG.commissionRate;
                }
                
                uplineChain.forEach((upline, level) => {
                    if (level >= MLM_CONFIG.levels) return;
                    
                    const commission = commissionBase * Math.pow(0.5, level);
                    const uplineUser = users.find(u => u.email === upline);
                    
                    if (uplineUser) {
                        uplineUser.cryptoWallet.balance += commission;
                        
                        uplineUser.transfers.push({
                            type: 'mlm',
                            amount: commission,
                            from: newUserId,
                            level: level + 1,
                            timestamp: new Date().toISOString()
                        });
                        
                        UserSystem.addNotification(uplineUser, `You earned ${commission.toFixed(6)} MZLx from level ${level + 1} referral!`);
                    }
                });
                
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            static getUplineChain(startEmail, levels) {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const chain = [];
                let currentEmail = startEmail;
                
                for (let i = 0; i < levels; i++) {
                    const user = users.find(u => u.email === currentEmail);
                    if (!user || !user.referredBy) break;
                    
                    const upline = users.find(u => u.referralCode === user.referredBy);
                    if (!upline) break;
                    
                    chain.push(upline.email);
                    currentEmail = upline.email;
                }
                
                return chain;
            }
        }

        // Voting System
        class VotingSystem {
            static submitVote(newPrice) {
                const user = UserSystem.getCurrentUser();
                if (!user) return { error: 'Not authenticated' };
                
                const hasVotingRight = user.badges.some(badge => 
                    badge === 'bronze' || badge === 'silver' || badge === 'gold' || badge === 'platinum'
                );
                
                if (!hasVotingRight) {
                    return { error: 'Only badge holders can vote' };
                }
                
                const now = new Date();
                const nigeriaTime = new Date(now.toLocaleString("en-US", {timeZone: "Africa/Lagos"}));
                const hours = nigeriaTime.getHours();
                const minutes = nigeriaTime.getMinutes();
                
                if (hours < 18 || (hours === 23 && minutes > 30) || hours >= 24) {
                    return { error: 'Voting only allowed between 6pm - 11:30pm WAT' };
                }
                
                const votes = JSON.parse(localStorage.getItem('votes') || '[]');
                votes.push({
                    userId: user.email,
                    price: newPrice,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('votes', JSON.stringify(votes));
                
                UserSystem.addNotification(user, `Vote submitted for new price: $${newPrice}`);
                
                return { success: true };
            }
        }

        // Social Media System
        class SocialSystem {
            static rewardSocialActivity(type) {
                const user = UserSystem.getCurrentUser();
                if (!user) return;
                
                let points = 0;
                
                switch(type) {
                    case 'like': points = 1; break;
                    case 'comment': points = 2; break;
                    case 'share': points = 3; break;
                    case 'watch': points = 5; break;
                    case 'live': points = 10; break;
                }
                
                user.socialPoints += points;
                
                UserSystem.addNotification(user, `You earned ${points} social points for ${type} activity!`);
                
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const updatedUsers = users.map(u => u.email === user.email ? user : u);
                localStorage.setItem('users', JSON.stringify(updatedUsers));
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                return points;
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize systems
            const miningSystem = new MiningSystem();
            
            // Load mined data if exists
            if (localStorage.getItem('totalMined')) {
                miningSystem.totalMined = parseFloat(localStorage.getItem('totalMined'));
                document.getElementById('miningTotal').textContent = miningSystem.totalMined.toFixed(6) + ' MZLx';
                if (miningSystem.totalMined > 0) {
                    document.getElementById('claimButton').style.display = 'flex';
                }
            }
            
            // Initialize countdown timer
            function initCountdown() {
                const endDate = new Date();
                endDate.setDate(endDate.getDate() + 120);
            
                function updateCountdown() {
                    const now = new Date();
                    const diff = endDate - now;
                    
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    
                    document.getElementById('days').textContent = days;
                    document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                    document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                }
            
                setInterval(updateCountdown, 60000);
                updateCountdown();
            }
            initCountdown();
            
            // Update current price display
            document.getElementById('currentPrice').textContent = TOKENOMICS.currentPrice.toFixed(3);
            
            // Social Media Overlay
            const socialOverlay = document.getElementById('socialOverlay');
            const closeSocial = document.getElementById('closeSocial');
            
            // Check if user is logged in
            const user = UserSystem.getCurrentUser();
            if (user) {
                socialOverlay.style.display = 'none';
            } else {
                // Show social overlay for new visitors
                socialOverlay.style.display = 'flex';
            }
            
            closeSocial.addEventListener('click', function() {
                socialOverlay.style.display = 'none';
            });
            
            // Social interactions
            document.querySelectorAll('.social-action').forEach(action => {
                action.addEventListener('click', function() {
                    const type = this.querySelector('.social-label').textContent.toLowerCase();
                    SocialSystem.rewardSocialActivity(type);
                });
            });
            
            // Auth Event Listeners
            document.getElementById('loginBtn').addEventListener('click', function() {
                document.getElementById('loginModal').style.display = 'flex';
            });
            
            document.getElementById('registerBtn').addEventListener('click', function() {
                document.getElementById('registerModal').style.display = 'flex';
            });
            
            document.getElementById('showRegister').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('registerModal').style.display = 'flex';
            });
            
            document.getElementById('confirmRegister').addEventListener('click', function() {
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const referralCode = document.getElementById('referralCode').value || null;
                
                const result = UserSystem.register(email, password, referralCode);
                if (result.error) {
                    alert(result.error);
                } else {
                    alert('Registration successful!');
                    document.getElementById('registerModal').style.display = 'none';
                    location.reload();
                }
            });
            
            document.getElementById('confirmLogin').addEventListener('click', function() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                const user = UserSystem.login(email, password);
                if (user) {
                    alert('Login successful!');
                    document.getElementById('loginModal').style.display = 'none';
                    location.reload();
                } else {
                    alert('Invalid email or password');
                }
            });
            
            // Mining Event Listeners
            document.getElementById('miningButton').addEventListener('click', function() {
                if (!UserSystem.getCurrentUser()) {
                    alert('Please login to start mining');
                    document.getElementById('loginModal').style.display = 'flex';
                    return;
                }
                
                if (miningSystem.isMining) {
                    miningSystem.stopMining();
                } else {
                    miningSystem.startMining();
                }
            });
            
            document.getElementById('claimButton').addEventListener('click', function() {
                miningSystem.claimTokens();
            });
            
            // Save & Earn
            document.getElementById('saveEarnBtn').addEventListener('click', function() {
                if (!UserSystem.getCurrentUser()) {
                    alert('Please login to use Save & Earn');
                    document.getElementById('loginModal').style.display = 'flex';
                    return;
                }
                document.getElementById('saveEarnModal').style.display = 'flex';
            });
            
            document.getElementById('submitDeposit').addEventListener('click', function() {
                const amount = parseFloat(document.getElementById('depositAmount').value);
                const date = document.getElementById('receiptDate').value;
                const time = document.getElementById('receiptTime').value;
                
                if (amount < 500 || amount > 2000000) {
                    alert('Amount must be between ₦500 and ₦2,000,000');
                    return;
                }
                
                if (!date || !time) {
                    alert('Please provide receipt date and time');
                    return;
                }
                
                const deposit = SaveEarn.submitDeposit(amount, date, time);
                if (deposit.error) {
                    alert(deposit.error);
                } else {
                    alert('Deposit submitted for approval!');
                    document.getElementById('saveEarnModal').style.display = 'none';
                }
            });
            
            // Flutterwave payment
            document.getElementById('processFlutterwave').addEventListener('click', function() {
                const amount = parseFloat(document.getElementById('fwAmount').value);
                if (amount < 500) {
                    alert('Minimum deposit is ₦500');
                    return;
                }
                SaveEarn.processFlutterwave(amount);
            });
            
            // Dashboard
            document.getElementById('platformWalletBtn').addEventListener('click', function() {
                const user = UserSystem.getCurrentUser();
                if (!user) {
                    alert('Please login to view wallet');
                    document.getElementById('loginModal').style.display = 'flex';
                    return;
                }
                
                document.getElementById('cryptoAddress').textContent = user.cryptoWallet.address;
                document.getElementById('cryptoBalance').textContent = user.cryptoWallet.balance.toFixed(6);
                document.getElementById('fiatAccount').textContent = user.fiatWallet.account;
                document.getElementById('fiatBalance').textContent = user.fiatWallet.balance.toFixed(2);
                
                // Load notifications
                const notificationList = document.getElementById('notificationList');
                notificationList.innerHTML = '';
                user.notifications.forEach(notif => {
                    const item = document.createElement('div');
                    item.style.padding = '10px';
                    item.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                    item.innerHTML = `
                        <p>${notif.message}</p>
                        <p style="font-size:0.7rem; color:rgba(255,255,255,0.6); margin-top:3px;">${new Date(notif.timestamp).toLocaleString()}</p>
                    `;
                    notificationList.appendChild(item);
                });
                
                document.getElementById('dashboardModal').style.display = 'flex';
            });
            
            // P2P Transfer
            document.getElementById('transferButton').addEventListener('click', async function() {
                const recipientAddress = document.getElementById('recipientAddress').value;
                const amount = parseFloat(document.getElementById('transferAmount').value);
                
                if (!recipientAddress || !amount) {
                    alert('Please fill all fields');
                    return;
                }
                
                const result = await P2PTransfer.transfer(recipientAddress, amount);
                if (result.error) {
                    alert(result.error);
                } else {
                    alert(`Successfully sent ${amount} MZLx!`);
                    document.getElementById('recipientAddress').value = '';
                    document.getElementById('transferAmount').value = '10';
                }
            });
            
            // Voting
            document.getElementById('submitVote').addEventListener('click', function() {
                const newPrice = parseFloat(document.getElementById('newPrice').value);
                if (newPrice < 0.001) {
                    alert('Minimum price is $0.001');
                    return;
                }
                
                const result = VotingSystem.submitVote(newPrice);
                if (result.error) {
                    alert(result.error);
                } else {
                    alert(`Vote submitted for new price: $${newPrice}`);
                }
            });
            
            // Buy MAZOL
            document.getElementById('buyButton').addEventListener('click', function() {
                const user = UserSystem.getCurrentUser();
                if (!user) {
                    alert('Please login to buy tokens');
                    document.getElementById('loginModal').style.display = 'flex';
                    return;
                }
                
                document.getElementById('buyModal').style.display = 'flex';
            });
            
            // Confirm purchase
            document.getElementById('confirmBuy').addEventListener('click', function() {
                const membershipLevel = document.getElementById('membershipLevel').value;
                const amount = parseFloat(document.getElementById('buyAmount').value);
                
                let minAmount = 0;
                switch(membershipLevel) {
                    case 'bronze': minAmount = 25; break;
                    case 'silver': minAmount = 1000; break;
                    case 'gold': minAmount = 2000; break;
                    case 'platinum': minAmount = 1000; break;
                }
                
                if (amount < minAmount) {
                    alert(`Minimum amount for ${membershipLevel} is ${minAmount} MZLx`);
                    return;
                }
                
                const user = UserSystem.getCurrentUser();
                if (user) {
                    UserSystem.addBadge(user, membershipLevel);
                    user.cryptoWallet.balance += amount;
                    
                    if (user.referredBy) {
                        MLMSystem.processReferral(user.referredBy, user.email, 'purchase', amount);
                    }
                    
                    alert(`Successfully purchased ${amount} MZLx and upgraded to ${membershipLevel} membership!`);
                    document.getElementById('buyModal').style.display = 'none';
                    location.reload();
                }
            });
            
            // Admin button
            document.getElementById('adminBtn').addEventListener('click', function() {
                document.getElementById('adminAccessModal').style.display = 'flex';
            });
            
            // Admin login with PIN
            document.getElementById('adminLoginBtn').addEventListener('click', function() {
                const username = document.getElementById('adminUsername').value;
                const password = document.getElementById('adminPassword').value;
                const pin = document.getElementById('adminPin').value;
                
                const ADMIN_CREDENTIALS = {
                    username: "admin",
                    password: "Masolites123",
                    pin: "123456"
                };
                
                if (username === ADMIN_CREDENTIALS.username && 
                    password === ADMIN_CREDENTIALS.password && 
                    pin === ADMIN_CREDENTIALS.pin) {
                    localStorage.setItem('adminLoggedIn', 'true');
                    window.location.href = 'admin.html';
                } else {
                    document.getElementById('adminError').textContent = 'Invalid admin credentials or PIN';
                    document.getElementById('adminError').style.display = 'block';
                }
            });
            
            // Connect to Metamask
            document.getElementById('connectWalletBtn').addEventListener('click', async function() {
                if (typeof window.ethereum === 'undefined') {
                    alert('Metamask not detected! Please install Metamask first.');
                    return;
                }
                
                try {
                    // Simulated connection for demo
                    const user = UserSystem.getCurrentUser();
                    if (user) {
                        alert('Wallet connected successfully!');
                    } else {
                        alert('Please login first');
                    }
                } catch (error) {
                    console.error('Error connecting to Metamask:', error);
                    alert('Failed to connect to wallet. Please try again.');
                }
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                UserSystem.logout();
                location.reload();
            });
            
            // Profile update
            document.getElementById('updateProfile').addEventListener('click', function() {
                const user = UserSystem.getCurrentUser();
                if (!user) return;
                
                user.fullName = document.getElementById('userFullName').value;
                user.phone = document.getElementById('userPhone').value;
                
                const users = JSON.parse(localStorage.getItem('users') || []);
                const updatedUsers = users.map(u => u.email === user.email ? user : u);
                localStorage.setItem('users', JSON.stringify(updatedUsers));
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                alert('Profile updated successfully!');
            });
            
            // Escrow Shop
            document.getElementById('escrowShopBtn').addEventListener('click', function() {
                const user = UserSystem.getCurrentUser();
                if (!user) {
                    alert('Please login to use Escrow Shop');
                    document.getElementById('loginModal').style.display = 'flex';
                    return;
                }
                
                // Load products
                loadProducts();
                document.getElementById('escrowShopModal').style.display = 'flex';
            });
            
            // List product
            document.getElementById('listProductBtn').addEventListener('click', function() {
                const name = document.getElementById('productName').value;
                const description = document.getElementById('productDescription').value;
                const price = parseFloat(document.getElementById('productPrice').value);
                const category = document.getElementById('productCategory').value;
                
                if (!name || !description || !price) {
                    alert('Please fill all fields');
                    return;
                }
                
                const result = EscrowShop.listProduct(name, description, price, category);
                if (result.error) {
                    alert(result.error);
                } else {
                    alert('Product listed successfully!');
                    document.getElementById('productName').value = '';
                    document.getElementById('productDescription').value = '';
                    document.getElementById('productPrice').value = '10';
                }
            });
            
            // Search products
            document.getElementById('searchProductsBtn').addEventListener('click', function() {
                loadProducts(document.getElementById('productSearch').value);
            });
            
            // Buy product
            document.getElementById('buyProductBtn').addEventListener('click', async function() {
                const productId = parseInt(this.dataset.productId);
                
                const result = await EscrowShop.buyProduct(productId);
                if (result.error) {
                    alert(result.error);
                } else {
                    alert('Purchase successful!');
                    document.getElementById('productDetailModal').style.display = 'none';
                    document.getElementById('escrowShopModal').style.display = 'flex';
                    loadProducts();
                }
            });
            
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.dataset.tab;
                    const tabsContainer = this.closest('.tabs');
                    
                    tabsContainer.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const contentContainer = this.closest('.modal-body');
                    contentContainer.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tab}Tab`).classList.add('active');
                });
            });
            
            // Modal close buttons
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            });
            
            // Display user badges
            function displayBadges() {
                const user = UserSystem.getCurrentUser();
                const badgeContainer = document.getElementById('badgeContainer');
                badgeContainer.innerHTML = '';
                
                if (user) {
                    const badges = {
                        'free': { icon: 'fas fa-gift', class: 'badge-free' },
                        'bronze': { icon: 'fas fa-medal', class: 'badge-bronze' },
                        'silver': { icon: 'fas fa-medal', class: 'badge-silver' },
                        'gold': { icon: 'fas fa-medal', class: 'badge-gold' },
                        'platinum': { icon: 'fas fa-star', class: 'badge-platinum' }
                    };
                    
                    user.badges.forEach(badge => {
                        if (badges[badge]) {
                            const badgeEl = document.createElement('div');
                            badgeEl.className = `badge ${badges[badge].class}`;
                            badgeEl.innerHTML = `<i class="${badges[badge].icon}"></i>`;
                            badgeEl.title = badge.charAt(0).toUpperCase() + badge.slice(1);
                            badgeContainer.appendChild(badgeEl);
                        }
                    });
                }
            }
            
            // Load products for Escrow Shop
            function loadProducts(searchTerm = '') {
                const products = EscrowShop.getAllProducts();
                const productGrid = document.getElementById('productGrid');
                productGrid.innerHTML = '';
                
                const user = UserSystem.getCurrentUser();
                const discount = user ? UserSystem.getDiscount(user) : 0;
                
                const filteredProducts = products.filter(product => 
                    product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    product.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    product.category.toLowerCase().includes(searchTerm.toLowerCase())
                );
                
                filteredProducts.forEach(product => {
                    const discountedPrice = product.price * (1 - discount);
                    
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.dataset.id = product.id;
                    productCard.innerHTML = `
                        <div class="product-image">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="product-title">${product.name}</div>
                        <div class="product-price">${discountedPrice.toFixed(2)} MZLx</div>
                        ${discount > 0 ? `<div class="discount-badge">${(discount * 100).toFixed(0)}% OFF</div>` : ''}
                    `;
                    
                    productCard.addEventListener('click', function() {
                        const productId = parseInt(this.dataset.id);
                        showProductDetail(productId);
                    });
                    
                    productGrid.appendChild(productCard);
                });
            }
            
            // Show product details
            function showProductDetail(productId) {
                const products = EscrowShop.getAllProducts();
                const product = products.find(p => p.id === productId);
                
                if (!product) return;
                
                const user = UserSystem.getCurrentUser();
                const discount = user ? UserSystem.getDiscount(user) : 0;
                const discountedPrice = product.price * (1 - discount);
                
                document.getElementById('productDetailTitle').textContent = product.name;
                document.getElementById('productDetailDescription').textContent = product.description;
                document.getElementById('productDetailPrice').textContent = `${discountedPrice.toFixed(2)} MZLx (${discount > 0 ? (discount * 100).toFixed(0) + '% OFF' : 'No discount'})`;
                document.getElementById('productDetailSeller').textContent = product.sellerName || product.sellerAddress.substring(0, 12) + '...';
                document.getElementById('productDetailCategory').textContent = product.category.charAt(0).toUpperCase() + product.category.slice(1);
                
                document.getElementById('buyProductBtn').dataset.productId = productId;
                
                document.getElementById('productDetailModal').style.display = 'flex';
            }
            
            // Check if user is logged in
            const user = UserSystem.getCurrentUser();
            if (user) {
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('registerBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'flex';
                displayBadges();
            }
        });
    </script>
</body>
</html>
